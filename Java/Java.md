## 자바에서 인코딩이 되는 과정



서론

* 문자열을 입력받을 때, Scanner와 BufferedReader중 어느 것을 활용하느냐에 따라 성능 차이를 비교하던 도중, 입력받을 때 활용하는 인코딩 방식과 자바 메모리에서 활용하는 인코딩 방식이 다르다는 것을 발견
  * Scanner와 InputStreamReader의 성능 차이가 발생하는 이유는 별도의 문서로 다룰 예정





본론

1. 개발자가 자바언어로 소스 파일을 작성하고 나서, 결과물을 콘솔에 출력하기 까지의 과정에서 인코딩은 아래와 같이 일어난다.

   * 입력장치(UTF - 8) → 송수신(modified UTF-8) → 자바 메모리(UTF-16) → 송수신(modified UTF-8) → 출력(UTF-8)

     * 각 단계에 대한 설명은 아래와 같다.

       1`) 입력장치에서는, "사용자 지정 encoding 값" 또는 "운영체제에서 설정된 인코딩 형식" 을 사용

       2`) 자바 메모리 단계에서는,  1)에서 입력받은 인코딩 값을 다시 UTF-16 형식으로 인코딩되어 메모리에 저장된다.

       => UTF-16은 거의 모든 문자를(한글 포함) 2byte로 저장하므로, 자바에서 char 타입은 2bytes를 차지한다.

       3`) 출력장치에서는, 다시 2)~1)과정을 거꾸로 하는 과정이라고 볼 수 있다.

       => 즉, UTF-16 인코딩 규칙으로 저장된 값을, 다시 "운영체제에서 설정한 인코딩 형식"에 대응되는 문자를 출력

   



2. InputStream 을 시작으로, 보조 스트림 InputStreamReader와 BufferedReader를 붙여서 완성된다.

   * InputStream은 1Byte만 읽어들인다는 한계가 존재하므로, UTF-8로 한글을 입력시(3byte) 아래의 엉뚱한 결과가 나타난다

     * 3 byte 중, 맨 앞의 1byte만 읽어들인 후, 해당 값에 대응되는 UTF-16 인코딩 값이 자바 메모리 상에 저장된다.

       => 후에 출력될 때에도, 해당 UTF-16 인코딩 값과 대응되는 문자가 출력된다.

   * 위의 사항을 보완하기 위해서, InputStreamReader를 활용한다.

     * 이는, byte 스트림을 문자 스트림으로 변환하는 역할을 한다.

       * 이러한 역할은 Charset 클래스가 담당하고 있다고 한다. 

     * 문자를 받기는 하나, 여전히 문자열을 처리하려면 배열을 선언해서 매개변수로 넘겨야 한다는 불편함이 존재

       => BufferedReader 등장

   * BufferedReader를 활용하여, 문자열로 받아서 처리가 된다.

     * 내부적으로 버퍼를 두어서, 입력받은 문자를 저장하여 한번에 문자열처럼 보내버린다.

       => 이 과정은 아래의 특징이 있다.

       * 1') 문자에 대해 특정한 형식만을 허용하는 것이 아니다. 즉, 정규식 검사가 없다.

       * 2') 기본적인 버퍼가 8192bytes로, scanner의 버퍼(기본값 1024bytes)보다 훨씬 사이즈가 크다.

         



3. 이제 Scanner와 InputStreamReader의 성능 차이가 벌어지는 이유를 설명할 수 있다

   * Scanner 클래스는, 입력받은 문자열에 대해 정규식 검사를 거쳐 타입이 맞는지 확인하는 과정을 거친다.

     * 반면, BufferedReader 클래스는 이러한 과정이 없다.

   * Scanner 클래스보다 BufferedReader 클래스가 버퍼 사이즈가 훨씬 크다

     => 동일한 대용량 데이터를 자바 프로그램으로 전송 시, 데이터를 전송하는 횟수가 BufferedReader가 훨씬 적다.





출처

* https://st-lab.tistory.com/41







