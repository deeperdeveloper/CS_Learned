구조가 3가지 중에 무엇인지 따져보는 습관



### 세 가지 네트워크 장치 구조



Inline은 공기 청정기 생각하기

=> 대표적인 장치가 "라우터"



Out of Path는 다루는 데이터 단위는 같으나, 차단/허용의 개념이 아니라, "인지"(즉 읽기) 가 주 목적

=> 보안상 이슈를 "인지" 하면 보안센서이다.

=> 네트워크 장애를 "인지"하면 장애센서 이다.



따라서, 네트워크 센서라고 하면 거의 Out Of path 구조이다.

** Tab 스위치를 통해서, 패킷을 복사받고 분석해서 센서가 결과를 알려줌.



Proxy는 데이터 단위가 "스트림 수준" => 스트림 데이터를 볼 수 있다는 장점이 있다.

(예) 10MB 파일을 보려면(=패킷에서 스트림을 얻으려면), 거의 10000개의 패킷을 조립해야 한다. 이는 굉장히 어려운 일이다.)

=> 따라서, 파일 수준의 데이터 단위를 다룰 떄, Proxy 구조를 다룬다.

=> 구조 자체는 Inline과 비슷(Drop/Bypass 기능이 있다.)

=> But, ReadOnly는 존재하지 않는다. 

(대리자를 통해서 지나가는 개념이라, 어플리케이션 전체를 모니터링 한다. )



 (노트 그림 보기)



### Inline 구조

-Inline 구조

고속도로(네트워크)에서 자동차(패킷)이 움직일 때는, 톨게이트를 반드시 통과해야 한다.



inline구조의 예) 공유기, 라우터, 방화벽(패킷 필터링 방화벽), IPS 등



=> 이처럼, 어느 한 컴퓨터에서 다른 서버로 접속할 때, 여러 Inline 장치를 거쳐서 도달하게 된다.





라우터도 "랜카드가 여러 개 달린" 컴퓨터라고 생각하면 되게 쉽다!



<라우터의 구조>

택배기사가 물건을 받았다고, 소유권이 택배기사에 있는 것이 아니듯이, 라우터는 "남의 데이터"를 받아서 byPass나 drop을 결정한다.



=> 구현은 커널모드에서 이루어진다(당연히, 입출력속도가 커널모드가 user Mode보다 훨씬 빠르기 때문이다.)



(그림 참조)

가속 NIC은, 커널모드에서 이루어지는 작업(IP 패킷 분해 등)을 하드웨어 수준에서 처리한다

=> 이는, 순전히 속도 문제 때문이다.

=> 따라서, Inline Device는 "Throughput"이라는 용어까지 있을 정도이다. 

(예를 들어 네트워크가 10Gbps 급이라도, 중간에 Router 하나가 1Gbps 급이라면 전체 네트워크 성능은 하향평준화가 될 수 밖에 없다.)

=> 그래서, 하드웨어 수준에서 들어오고 나가고를 바로 하는 것이 가장 이상적

=> 따라서, 하드웨어와 inline module(즉, s/w)의 기능의 절충안을 찾는 것이 가장 일반적.



=> 이제 정리하면, Inline Device는 들어온 패킷을 Drop하거나 pass 시킬 수 있다. 어떤 로직으로 이러한 것을 결정하는 가에 따라, Inline Device의 성격이 완전히 바뀐다.





** 여담으로, Router역시 컴퓨터이다. 따라서, 아래의 경우도 가능하다

* Router에 windows 운영체제 설치

* 내 컴퓨터에 Router에서 사용하는 OS 설치

  => 이 경우, 내 컴퓨터는 Router 역할을 한다

=> 따라서, Cisco는 단순히 H/W 회사 뿐만 아니라, Inline Device기능을 하도록 S/W 모듈과 자체 OS까지 같이 만드는 회사라고 볼 수 있다.



### Out of path 구조와 DPI 그리고 망중립

Out of Path의 또다른 이름은 "Sensor" 이다.

=> Sensing할 네트워크 장비가 있어야 한다.

=> "L2 수준에서의 Port Mirroring"이다. (즉,  패킷이 유통될 때, 복사해서 보자라는 의미이다.)

=> 즉, 스위치가 스위칭하는 모든 L2 Frame을 어느 특정 다른 port로 copy한다는 의미이다.

 



Mirroring은 부하가 많이 걸리므로, 하드웨어 적으로 우수해야 한다.

=> 스위치 중, "Tab switch" 라고 있음 (Mirroring만 전문적으로 함)

=> 해당 스위치의 port가 10개라면, 8개의 포트가 mirroring 역할을 수행한다. (2개 포트를 통해 switch를 통과하는 패킷을 대략 8곳에 복사하는 역할을 한다. )

=> 따라서, 부하가 많이 걸리므로, 고성능이다.

=> 이렇게 많이 복사하는 이유는, 2개는 보안에 쓰고, 2개는 장애 대응에 쓰고..... 등이다.



Out of path의 목적은, "분석" 혹은 "탐지"의 목적이다.

=> 따라서, Sensor는, "수집 장치"라는 단어와 항상 따라다닌다.



#### 반사회적 사이트 접속 차단 원리

* www.abc.com 입력 시, warning 페이지가 뜨게 하려면 아래와 같다 (대략적인 설명)

  1. ISP 수준에서 패킷을 수집한다.
  2. Sensor(Out of Path 구조 Device)가 해당 사이트가 접속하면 안 되는 사이트임을 인지
  3. 위의 Device가 거짓응답을 클라이언트에게 보내서, www.abc.com의 응답결과로 warning 페이지가 보이게끔 한다.

  

  

* 아래의 용어를 알아야 한다.

  * L7 HTTP 수준에서 알아야 할 용어

    * TCP/IP 헤더 이외에 HTTP 헤더를 들여다 보는 행위 => SPI 라고 한다. (Shallow packet Inspection)

    * 그리고 data 부분을 읽는 행위 => DPI 라고 한다. (Deep packet Inspection)
    * 우리는 SPI가 합법화된 나라이다. (DPI는 무조건 문제가 된다.)

=> 따라서, ISP의 Sensor가 하는 역할은, SPI를 이용하는 것이다. 

=> 여기서 "망 중립성의 원칙" 이라는 용어 등장

=> (왜냐하면, SPI를 남발하면 ISP provider www.youtube.com 같은 사이트를 차단할 수도 있기 때문에, 이에 대한 남용을 금지하는 법.)



위를 통해, Sensor의 핵심 기술은 "놓치지 않고 수집하는 것" 임을 알 수 있다.

 



-- 약간 용어가 모호한 부분이 있기는 하지만, 계속 진행



### Proxy - 우회

아래의 2가지 목적이 있다,

* 서버 입장(www.abc.com)에서, 출발지가 "철수 본인의 IP 주소"이 아닌 "프록시 서버의 IP 주소" 로 인식하게끔 하기 위함

  => 이로 인해, 출발지의 정체를 숨기기 위한 목적

* ISP가 www.abc.com의 접속을 차단하게끔 한다면, (혹은 서버 www.abc.com이 철수의 접근을 차단한다면)

  => 철수는 프록시 서버를 설정해서, 프록시 서버를 통해 www.abc.com에 접속하게 된다.

  => 철수는 프록시 서버와 TCP/IP Connection을 맺게 되며, 반대로 프록시 서버와 Web Server는 또 다른 TCP/IP Connection을 맺게 된다.



따라서, Proxy 서버의 구조는 아래와 같이 요약이 된다.

* 소켓을 2개(Listen 소켓, Client 소켓)을 연다
  * Listen 소켓을 통해, 철수의 패킷을 받게 된다.
    * 해당 패킷에는, www.abc.com 에 연결해달라는 요청이 담긴 데이터(?)가 담겨 있다.
  * Proxy 서버는, Client 소켓을 통해 www.abc.com이 목적지인 패킷을 보낸다. (물론 이 때, 패킷의 출발지는 Proxy 서버의 외부 IP 주소이다.)
* 우회 목적의 Proxy 는, 네트워크 외부에 위치한다는 것이 특징





### Proxy - 보호, 감시

해당 Proxy 서버는 사내 네트워크에 있다는 것이 특징

* 사내 네트워크에 속하는 단말은, 무조건 Proxy서버를 통해서만 인터넷에 접속할 수 있게끔 방화벽을 (IPS를)설정하면 된다. 

  * IPS와 방화벽 차이는 찾아보기. 용어가 살짝 혼용해서 쓴 감이 있음.
  * 이로 인해, 프록시 서버에 남긴 기록을 토대로 감시가 된다.

* 또한, 인터넷을 통해 외부 사이트에서 파일을 다운로드 받을 때, 프록시 서버에서 "스트림 수준"으로 파일이 안전한지 검증이 가능하다

  * IPS나 방화벽은 패킷 수준으로 통과 여부를 결정하므로, 파일의 안전성을 검증하는데 한계가 있다는 점을 "프록시 서버" 가 보완해준다.

    

(현재까지 내용 다듬기 - 23.07.26)